<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script>
    function includeHTML() {
        var z, i, elmnt, file, xhttp;
        /*loop through a collection of all HTML elements:*/
        z = document.getElementsByTagName("*");
        for (i = 0; i < z.length; i++) {
            elmnt = z[i];
            /*search for elements with a certain atrribute:*/
            file = elmnt.getAttribute("w3-include-html");
            if (file) {
                /*make an HTTP request using the attribute value as the file name:*/
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        if (this.status == 200) {
                            elmnt.innerHTML = this.responseText;
                        }
                        if (this.status == 404) {
                            elmnt.innerHTML = "Page not found.";
                        }
                        /*remove the attribute, and call this function once more:*/
                        elmnt.removeAttribute("w3-include-html");
                        includeHTML();
                    }
                }
                xhttp.open("GET", file, true);
                xhttp.send();
                /*exit the function:*/
                return;
            }
        }
    };
</script>
<body>
<div w3-include-html="/bootstrap/form/header.html"></div>
<div w3-include-html="/bootstrap/form/nav-bar.html"></div>

<div class="container-fluid d-flex">
    <div class="left col-12">
        <div class="d-flex m-2">
            <div class="col-8">
                <h1>Danh sách khách hàng</h1>
            </div>
            <div class="col-4 m-2">
                <form action="/customer/search" method="post">

                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="Tìm kiếm khách hàng" name="key"
                               aria-label="Tìm kiếm khách hàng" aria-describedby="basic-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit">Tìm kiếm</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div th:if="${mess}" style="color: #005cbf">
            <span th:text="${mess}"></span>
        </div>
        <div class="d-flex">
            <div class="col-10">
            </div>
            <div class="col-2 text-right">
                <a type="button" class="btn btn-outline-info" style="margin-right: 2px" href="/customer/create">Thêm mới khách hàng
                </a>
            </div>
        </div>
        <table id="tables" class="table table-striped table-bordered" style="width:100%">
            <thead>
            <tr>
                <th>ID</th>
                <th>Mã</th>
                <th>Tên khách hàng</th>
                <th>Ngày sinh</th>
                <th>Giới tính</th>
                <th>Số CMND</th>
                <th>Điện thoại</th>
                <th>Email</th>
                <th>Địa chỉ</th>
                <th>Loại khách hàng</th>
                <th>Tuỳ chọn</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="row : ${customerList}">
                <td th:text="${row.getId()}"></td>
                <td th:text="${row.getCode()}"></td>
                <td th:text="${row.getName()}"></td>
                <td th:text="${row.getBirthday()}"></td>
                <td th:if="${row.getGender() == 1}" th:text="Nữ"></td>
                <td th:if="${row.getGender() == 0}" th:text="Nam"></td>
                <td th:text="${row.getIdCard()}"></td>
                <td th:text="${row.getPhone()}"></td>
                <td th:text="${row.getEmail()}"></td>
                <td th:text="${row.getAddress()}"></td>
                <td th:text="${row.getCustomerType.getName()}"></td>
                <td>
                    <a type="button" class="btn btn-outline-primary" th:href="@{/customer/{id}/edit(id=${row.getId()})}">Sửa</a>
                    <button type="button" class="btn btn-outline-danger" data-toggle="modal" data-target="#delete"
                            th:attr="onclick=|deleteModal('${row.getId}', '${row.getCode}', '${row.getName}')|" >Xóa
                    </button>
                </td>

            </tr>
            </c:forEach>
            </tbody>
        </table>
        <div class="d-flex">
            <div class="col-8">
            </div>
            <div class="col-4 text-right">
                     <span>
        <a type="button" class="btn btn-outline-info" style="margin-right: 2px" th:if="${customerList.hasPrevious()}" th:href="@{/customer/(page = ${customerList.number - 1})}">◄</a>
                    </span>
                <span th:each="pageNo: ${#numbers.sequence(0,customerList.totalPages - 1)}">
        <a type="button" class="btn btn-outline-info" style="margin-right: 2px" th:href="@{/customer/(page = ${pageNo})}" th:text="${pageNo}"></a>
                    </span>
                <span>
        <a type="button" class="btn btn-outline-info" style="margin-right: 2px" th:if="${customerList.hasNext()}" th:href="@{/customer/(page = ${customerList.number + 1})}">►</a>
                    </span>
            </div>
        </div>


    </div>
</div>
<!-- Modal delete -->
<div class="modal fade" id="delete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabeldelete" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabeldelete">Xoá Khách hàng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-center" id="bodyDeleteCustomer">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <form action="/customer/delete" method="post">
                    <input hidden type="text" name="idDelete" id="idDelete" value="">
                    <button type="submit" class="btn btn-danger">Đồng ý</button>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Modal delete -->
<script src="/bootstrap/js/jquery-3.6.0.min.js"></script>
<script src="/bootstrap/js/bootstrap.min.js"></script>
<div w3-include-html="/bootstrap/form/footer.html"></div>
<script>
    function deleteModal(id, code, name) {
        document.getElementById("idDelete").value = id;
        document.getElementById("bodyDeleteCustomer").innerHTML = "Mã khách hàng: <b style='color: #005cbf'>" + code + "</b><br>" +
                                                                  "Tên khách hàng <b style='color: #005cbf'>" + name + "</b><br>" +
                                                                   "Xóa khách hàng này chứ ?";
    }
</script>
<script>
    includeHTML();
</script>
</body>
</html>